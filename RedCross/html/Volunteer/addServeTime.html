<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">	
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/mui.picker.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<script>
			!function(){function a(){document.documentElement.style.fontSize=document.documentElement.clientWidth/7.5+"px"}var b=null;window.addEventListener("resize",function(){clearTimeout(b),b=setTimeout(a,10)},!1),a()}(window);
		</script>
		<title>新增</title>
		<style>
			body,html{ 
				height:100%;
				background-color:#FFFFFF;
				color:#000000;
			}
			
			.mui-content{
				background-color:#FFFFFF;
			}
			
			.mui-row{
				padding:20px 10px;
			}
			
			.line{
				border-top:1px solid #C0C0C0;
			}
			
			.mui-row p{
				padding:0px 10px;
				/*margin:20px 0 5px 10;*/
			}
			
			.top{
				margin-top:10px;
			}
			
			.mui-icon{
				float:right;
			}
			
			.text_name{
				font-size:0.3rem;
				color:#696969;
			}
			input{
				float: right;
				font-size: 0.3rem;
			}
			input.activityName{
				width:50%;height:0.4rem;padding:0;margin-bottom:0;border: none;outline: medium;
			}
			.btn{
				margin-top:40px;
				background-color:#36ccab;
				border-radius:5px;
				width:100%;
				height:0.8rem;
				line-height: 0.8rem;
				text-align: center;
				font-size: 0.35rem;
				color:#FFFFFF;
			}
			.top input{
				width:55%;height:0.4rem;padding:0;margin-bottom:0;border: none;outline: medium;
			}
		</style>
	</head>
	<body>
		
		<div id="app">
			<div class="mui-content">
				<div class="mui-row">
					<p>
						<lable class="text_name">活动名称</lable>
						<span @click="userClick" class="mui-icon mui-icon-forward"></span>
						<input v-model="activityText" class="activityName" type="text" name="activityName" value=""/>
						
					</p>
					<div class="line"></div>
					
					<p class="top">
						<lable class="text_name">基础志愿服务时间：</lable>
						<input v-model="hours" class="time" type="number" name="time" value=""/>		
					</p>
					<div class="line"></div>
					
					<div class="btn" @click="addServerTime">保存</div>
				</div>
			</div>	
		</div>
		
		<script type="text/javascript" src="../../js/mui.min.js" ></script>
		<script type="text/javascript" src="../../js/vue.min.js" ></script>
		<script type="text/javascript" src="../../js/comm.js" ></script>
		<script src="../../js/mui.picker.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script>
			var name,rids;
			var vm = new Vue({
				el: '#app',
				data: {
					activityName:[], //活动名称列表
					activityText:'',
					rid:'',
					hours:''
				},
				mounted: function() {
					var self = this;
					self.activityNameList();
					
				},
				methods: {
					
					// 点击选择活动
					userClick: function(type) {
						var self = this;
						var doc = document;
						var userPicker = new mui.PopPicker();
						userPicker.setData(self.activityName);
						userPicker.show(function(items) {
							document.activeElement.blur();// 关闭输入法的api
							self.activityText = items[0].text;
							self.rid = items[0].value;
						});
					},
					//获取活动名称列表
					activityNameList: function(){
						var self = this;
						mui.rAjax({
							url:'/ajax.php',
							data:{
								act:"addtimelist"
							},
							dataType:'json',//服务器返回json格式数据
							type:'GET',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							success:function(data){
								//服务器返回响应，根据响应结果，分析是否登录成功；
								console.log(data.datas);
								// 遍历出所有活动名称
								for(var i in data.datas){
									var activy = {};
									activy.value = data.datas[i].recordid;
									activy.text = data.datas[i].activityName;
									self.activityName.push(activy);
								}
								
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								console.log(type);
							}
						});
					},
					// 新增志愿服务时间
					addServerTime: function(){
						var self = this;
//						console.log(self.rid);
//						console.log(self.hours);
						mui.rAjax({
							url:'/ajax.php?act=servetime',
							data:{
								rid:self.rid,
								hours:self.hours
							},
							dataType:'json',//服务器返回json格式数据
							type:'POST',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							success:function(data){
								//服务器返回响应，根据响应结果，分析是否登录成功；
//								console.log(data);
								if(data.responseCode == 0){
									mui.toast("新增成功");
									window.location.href = "serverTimeManage.html";
								}else{
									mui.toast(data.responseMsg);
								}
								
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								console.log(type);
							}
						});
					}
				}
			})
		</script>
	</body>
</html>
