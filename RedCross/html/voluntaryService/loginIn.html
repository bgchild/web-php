<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>成为志愿者</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			html,body,.mui-content{
				background-color: #FFFFFF;
				font-size: 14px;
				color: #696969;
			}
			.left{
				float: left;
			}
			.right{
				float: right;
			}
			.clean{
				clear: both;
			}
			.mui-content{
				padding: 0 18px;
			}
			.title {
				font-size: 17px;
			    font-weight: 500;
			    line-height: 44px;
			    width: 100%;
			    padding: 0;
			    text-align: center;
			    white-space: nowrap;
			    margin: 0; 
			    color: #101010;
			}
			.mui-input-row:after{
			    position: absolute;
			    right: 0;
			    bottom: 0;
			    left: 0;
			    height: 1px;
			    content: '';
			    -webkit-transform: scaleY(.5);
			    transform: scaleY(.5);
			    background-color: #c8c7cc;
			}
			.mui-input-row input{
				color: #696969;
				font-size: 12.0px;
				border: 0;
				/*border-top: 0;
				border-left: 0;
				border-right: 0;*/
				margin-bottom: 0px;
				padding: 10px 20px;
			}
			.mui-btn.mui-btn-red{
				margin: 30px auto;
				width: 100%;
			}
			.mui-btn-red {
			    border: 1px solid #ff1f00;
			    background-color: #ff1f00;
			}
			.green{
				color: #36ccab;
				font-size: 12.0px;
			}
			.text{
				/*width: 90px;*/
				height: 40px;
				line-height: 30px;
				text-align: center;
			}
			.text img{
				/*width: 100%;*/
				height: 100%;
			}
		</style>
	</head>

	<body>
		<div id="vueLogin">
			<div class="mui-content">
				<h2 class="title">志愿者登录</h2>
				<div>
				    <div class="mui-input-row">
				   		<input v-model="userName" type="text" placeholder="用户名">
				    </div>
				    <div class="mui-input-row">
				        <input v-model="passwords" type="password" class="mui-input-password" placeholder="密码">
				    </div>
				    <div class="mui-input-row">
				        <input v-model="identify" type="text" placeholder="验证码" style="width: 60%;">
				        <div @click="checkCode" class="text right" style="padding: 0px;">
				        	<img id="img" :src="src"/>
				        </div>
				    </div>
				</div>
				<div class="mui-button-row">
					<button @click="loginClick" type="button" class="mui-btn mui-btn-red">登录</button>
				</div>
				<p class="green"><span @click="registerClick" class="register">志愿者注册</span><span @click="forgetPassword" class="right">忘记密码</span></p>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/vue.min.js" ></script>
		<script type="text/javascript" src="../../js/comm.js" ></script>
		<script type="text/javascript">
			var vm = new Vue({
				el: '#vueLogin',
				data: {
					userName:'',
					passwords:'',
					src:'',
					identify:'',
					urlOne:'',
					url:''
				},
				mounted: function() {
					var self = this;
					self.src=mui.apiUrl+"/ajax.php?act=checkCode&time="+Math.random();
					console.log(self.src);
					setCookie("newList","");
					self.urlOne = GetArgsFromHref(window.location.toString(),"urlOne");
					self.url = GetArgsFromHref(window.location.toString(),"urlTwo");
				},
				methods: {
					forgetPassword: function() {
						var self = this;
						setTimeout(function(){
							window.location.href = "./forgetPassword.html";
						},300);
					},
					registerClick: function() {
						var self = this;
						setTimeout(function(){
							window.location.href = "./register.html";
						},300);
					},
					checkCode: function() {
						var self = this;
						self.src=mui.apiUrl+"/ajax.php?act=checkCode&time="+Math.random();
					},
					loginClick: function() {
						var self = this;
						mui.rAjax({
							url:'/ajax.php?act=login',
							data:{
								username: self.userName,
								password: self.passwords,
								checkcode: self.identify
							},
							dataType:'json',//服务器返回json格式数据
							type:'POST',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							success:function(data){
								//服务器返回响应，根据响应结果，分析是否登录成功；
								console.log(data);
								if(data.responseCode == 0){
									setCookie("userId",data.datas.id);
									setCookie("username",data.datas.username);
									setCookie("signId",data.datas.signId);
									setCookie("name",data.datas.name);
									if(!Boolean(self.url)){
										window.location.href = '../Volunteer/myData.html'
									}else{
										window.history.go(-1);
//										if(self.urlOne == "voluntaryService"){
//											window.location.href = './'+self.url+'.html';
//										}else{
//											window.location.href = '../'+self.urlOne+'/'+self.url+'.html'
//										}
									}
									
								}else if(data.responseCode == 4){
									mui.toast(data.responseMsg);
									self.src=mui.apiUrl+"/ajax.php?act=checkCode&time="+Math.random();
								}else{
									mui.toast(data.responseMsg)
								}
//								alert(JSON.stringify(data))
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								console.log(type);
							}
						});
					}
				}
			})
		</script>
	</body>

</html>