<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>忘记密码</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			html,body,.mui-content{
				background-color: #FFFFFF;
				font-size: 14px;
				color: #696969;
			}
			.left{
				float: left;
			}
			.right{
				float: right;
			}
			.clean{
				clear: both;
			}
			.mui-content{
				padding: 20px 18px;
			}
			.mui-input-row:after{
			    position: absolute;
			    right: 0;
			    bottom: 0;
			    left: 0;
			    height: 1px;
			    content: '';
			    -webkit-transform: scaleY(.5);
			    transform: scaleY(.5);
			    background-color: #c8c7cc;
			}
			.mui-input-row input{
				color: #696969;
				font-size: 12.0px;
				border: 0;
				margin-bottom: 0px;
				padding: 10px 20px;
			}
			.mui-btn.mui-btn-red{
				margin: 30px auto;
				width: 100%;
			}
			.mui-btn-red {
			    border: 1px solid #36ccab;
			    background-color: #36ccab;
			}
			.mui-btn-red:enabled:active{
				border: 1px solid #36ccab;
				background:#36ccab;
			}
			.text{
				width: 85px;
				height: 30px;
				line-height: 30px;
				margin-top: 5px;
				background: #e6e6e6;
				text-align: center;
			}
		</style>
	</head>

	<body>
		<div id="vueForgetPas">
			<div class="mui-content">
				<div>
				    <div class="mui-input-row">
				   		<input v-model="cellphone" type="number" placeholder="请输入手机号">
				    </div>
				    <div class="mui-input-row">
				        <input v-model="code" type="text" placeholder="请输入验证码" style="width: 60%;">
				        <div @click="sendCode" class="text right" style="padding: 0px;">
				        	<span id="getCode">获取验证码</span>
				        </div>
				    </div>
				</div>
				<div class="mui-button-row">
					<button @click="clickNext" type="button" class="mui-btn mui-btn-red">下一步</button>
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/vue.min.js" ></script>
		<script type="text/javascript" src="../../js/comm.js" ></script>
		<script type="text/javascript">
			var vm = new Vue({
				el: '#vueForgetPas',
				data: {
					cellphone:'',
					code:'',
					flag:true
				},
				mounted: function() {
					var self = this;
				},
				methods: {
					//获取验证码
					sendCode: function() {
						var self = this;
						if(self.flag){
							mui.rAjax({
								url:'/ajax.php?act=sendSmsCode',
								data:{
									cellphone:self.cellphone
								},
								dataType:'json',//服务器返回json格式数据
								type:'POST',//HTTP请求类型
								timeout:10000,//超时时间设置为10秒；
								success:function(data){
									//服务器返回响应，根据响应结果，分析是否登录成功；
									console.log(data);
									if(data.responseCode == 0){
										self.settime(60);
										self.flag = false;
									}else{
										mui.toast(data.responseMsg);
									}
	//								alert(JSON.stringify(data))
								},
								error:function(xhr,type,errorThrown){
									//异常处理；
									console.log(type);
								}
							});
						}
					},
					//下一步
					clickNext: function(e){
						var self = this;
						mui.rAjax({
							url:'/ajax.php?act=checkSmsCode',
							data:{
								code:self.code
							},
							dataType:'json',//服务器返回json格式数据
							type:'POST',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							success:function(data){
								//服务器返回响应，根据响应结果，分析是否登录成功；
								console.log(data);
								if(data.responseCode == 0){
									window.location.href = "./modifyPassword.html";
								}else{
									mui.toast(data.responseMsg);
								}
//								alert(JSON.stringify(data))
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								console.log(type);
							}
						});
					},
					//60s倒计时
					settime:function (t) {
						var self = this;
						var time = setInterval(function() {
							if(t > 0) {
								mui("#getCode")[0].innerHTML = t--;
							} else {
								window.clearInterval(time);
								mui("#getCode")[0].innerHTML = "获取验证码";
								self.flag = true;
							}
						}, 1000);
					}
				}
			})
		</script>
	</body>

</html>